# Cursor Rules - Encurtador de URLs

## Estrutura do Projeto

Este é um projeto full-stack de encurtador de URLs com:
- **Frontend (web/)**: React + Vite + TypeScript + TailwindCSS + Shadcn/ui
- **Backend (server/)**: Node.js + Fastify + TypeScript + Drizzle ORM + PostgreSQL
- **Infraestrutura (infra/)**: Pulumi para IaC + Cloudflare R2

## Regras Gerais

### Controle de Versão - GIT
**IMPORTANTE**: NUNCA execute comandos git automaticamente sem autorização explícita do usuário.
- ❌ NÃO execute: git add, git commit, git push, git pull, git merge, git rebase
- ❌ NÃO crie branches automaticamente
- ❌ NÃO faça commits ou push sem permissão
- ✅ APENAS sugira comandos git para o usuário executar manualmente
- ✅ Pode usar git status, git diff, git log para leitura (somente visualização)

### Estilo de Código

#### TypeScript
- Use TypeScript estrito em todos os arquivos
- Evite `any`, prefira tipos explícitos ou genéricos
- Use Zod para validação de schemas quando necessário
- Prefira interfaces para objetos e types para uniões/interseções

#### React (Frontend)
- Use componentes funcionais com hooks
- Prefira React Query (@tanstack/react-query) para chamadas API
- Use React Hook Form + Zod para formulários
- Componentes UI devem usar Shadcn/ui quando possível
- Mantenha components na pasta `web/src/components`
- Estilos com TailwindCSS e tailwind-merge

#### Backend
- Use Fastify para rotas e plugins
- Drizzle ORM para queries ao banco
- Validação com Zod nos schemas de entrada
- Organize rotas em `server/src/routes`
- Services em `server/src/services` quando necessário
- Mantenha migrations em `server/drizzle`

#### Infraestrutura
- Use Pulumi para gerenciar recursos de cloud
- Não execute `pulumi up` ou `pulumi destroy` sem autorização
- Mantenha configurações sensíveis em variáveis de ambiente

### Segurança
- Nunca exponha credenciais, tokens ou secrets no código
- Use variáveis de ambiente (.env) para dados sensíveis
- Não commite arquivos .env
- Valide todas as entradas do usuário
- Evite SQL injection usando ORM (Drizzle)
- Sanitize URLs antes de processar

### Testes e Qualidade
- Antes de sugerir código, verifique compatibilidade com as versões das dependências
- Sugira testes quando implementar novas funcionalidades
- Mantenha código limpo e legível
- Comente apenas quando necessário (código deve ser auto-explicativo)

### Gerenciamento de Dependências
- Use npm para gerenciamento de pacotes
- Mantenha package.json organizado
- Evite adicionar dependências desnecessárias
- Verifique compatibilidade antes de sugerir novas libs

### Banco de Dados
- Use Drizzle ORM para queries
- Execute migrations via `npm run db:migrate`
- Não modifique o schema diretamente sem gerar migration
- Use `npm run db:generate` para criar migrations

### Docker
- Otimize Dockerfiles com multi-stage builds
- Use .dockerignore apropriadamente
- Mantenha imagens leves

## Estrutura de Pastas

```
/
├── web/              # Frontend React
│   ├── src/
│   │   ├── components/
│   │   ├── lib/
│   │   └── ...
│   └── package.json
├── server/           # Backend Node.js
│   ├── src/
│   │   ├── routes/
│   │   ├── services/
│   │   └── server.ts
│   ├── drizzle/      # Migrations
│   └── package.json
├── infra/            # Pulumi IaC
│   └── index.ts
└── docker-compose.yml
```

## Comandos Importantes

### Backend
- `npm run dev` - Servidor desenvolvimento
- `npm run build` - Build produção
- `npm run db:generate` - Gerar migration
- `npm run db:migrate` - Executar migrations

### Frontend
- `npm run dev` - Desenvolvimento
- `npm run build` - Build produção
- `npm run lint` - Lint código

### Infraestrutura
- `pulumi up` - Deploy infraestrutura (SOMENTE COM AUTORIZAÇÃO)
- `pulumi preview` - Preview mudanças

## Boas Práticas

1. **Sempre leia o código existente** antes de sugerir mudanças
2. **Mantenha consistência** com o estilo do projeto
3. **Documente decisões importantes** em comentários ou README
4. **Teste localmente** antes de sugerir código em produção
5. **Respeite a estrutura** de pastas existente
6. **Pergunte antes de fazer mudanças grandes** ou estruturais

## Nunca Faça

- ❌ Executar comandos git sem permissão
- ❌ Modificar .gitignore sem necessidade
- ❌ Adicionar dependências sem justificativa
- ❌ Fazer deploy (pulumi up, docker push) sem autorização
- ❌ Modificar configurações de produção diretamente
- ❌ Expor secrets ou credenciais
- ❌ Deletar arquivos sem confirmação
- ❌ Modificar arquivos de configuração críticos (.env.example, tsconfig.json) sem necessidade
